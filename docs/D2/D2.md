### **Step 2: Authentication & Core Features Development**

Congratulations on successfully setting up your project and database! Moving forward, we'll focus on implementing authentication for **Personnel** and **Authorized Users**, followed by developing the **Attendance Tracking** features.

---

## **2.1. Implement Authentication for Personnel and Authorized Users**

### **Objective:**
- Create separate login/logout functionalities for Personnel and Authorized Users.
- Restrict access to certain views based on user roles (`is_authorized` flag).

### **Approach:**
1. **Separate Login URLs and Views:**
   - Define distinct URLs for Personnel and Authorized Users login/logout.
   - Create separate view functions or class-based views for handling authentication.
   
2. **Templates:**
   - Design separate templates for Personnel and Authorized Users login pages.
   
3. **Redirect Users Based on Role:**
   - After successful login, redirect users to their respective dashboards based on the `is_authorized` flag.

4. **Protecting Views:**
   - Use Django decorators to restrict access to views based on user roles.

### **Step-by-Step Implementation:**

#### **2.1.1. Define Authentication URLs**

**Action:**
- Create separate URLs for Personnel and Authorized Users login/logout in your `employees` app.

**Implementation:**

1. **Create a `urls.py` in the `employees` App:**

   If not already present, create a `urls.py` file inside `backend/employees/`.

   ```bash
   touch backend/employees/urls.py
   ```

2. **Define URL Patterns:**

   ```python
   # backend/employees/urls.py

   from django.urls import path
   from . import views
   from django.contrib.auth import views as auth_views

   urlpatterns = [
       # Personnel Authentication
       path('login/personnel/', views.personnel_login, name='personnel_login'),
       path('logout/personnel/', auth_views.LogoutView.as_view(next_page='personnel_login'), name='personnel_logout'),

       # Authorized User Authentication
       path('login/authorized/', views.authorized_login, name='authorized_login'),
       path('logout/authorized/', auth_views.LogoutView.as_view(next_page='authorized_login'), name='authorized_logout'),
   ]
   ```

3. **Include `employees` URLs in the Project's `urls.py`:**

   ```python
   # backend/urls.py

   from django.contrib import admin
   from django.urls import path, include

   urlpatterns = [
       path('admin/', admin.site.urls),
       path('auth/', include('backend.employees.urls')),  # Namespace can be added if desired
   ]
   ```

#### **2.1.2. Create Authentication Views**

**Action:**
- Develop separate views for Personnel and Authorized Users login.

**Implementation:**

1. **Define Login Views in `views.py`:**

   ```python
   # backend/employees/views.py

   from django.shortcuts import render, redirect
   from django.contrib.auth import authenticate, login
   from django.contrib import messages
   from django.contrib.auth.decorators import login_required

   def personnel_login(request):
       if request.method == 'POST':
           username = request.POST.get('username')
           password = request.POST.get('password')
           user = authenticate(request, username=username, password=password)
           if user is not None and not user.is_authorized:
               login(request, user)
               return redirect('personnel_dashboard')  # Define this URL later
           else:
               messages.error(request, 'Invalid Credentials or Unauthorized Access.')
       return render(request, 'employees/personnel_login.html')

   def authorized_login(request):
       if request.method == 'POST':
           username = request.POST.get('username')
           password = request.POST.get('password')
           user = authenticate(request, username=username, password=password)
           if user is not None and user.is_authorized:
               login(request, user)
               return redirect('authorized_dashboard')  # Define this URL later
           else:
               messages.error(request, 'Invalid Credentials or Unauthorized Access.')
       return render(request, 'employees/authorized_login.html')
   ```

2. **Notes:**
   - **`personnel_login`**: Authenticates users where `is_authorized` is **False**.
   - **`authorized_login`**: Authenticates users where `is_authorized` is **True**.
   - **Redirect URLs** (`personnel_dashboard`, `authorized_dashboard`) should be defined in your URL configurations and corresponding views/templates created.

#### **2.1.3. Create Login Templates**

**Action:**
- Design separate HTML templates for Personnel and Authorized Users login pages.

**Implementation:**

1. **Create Templates Directory:**

   Ensure that your `templates` directory is set up correctly.

   ```bash
   mkdir -p backend/employees/templates/employees/
   ```

2. **Create `personnel_login.html`:**

   ```html
   <!-- backend/employees/templates/employees/personnel_login.html -->

   <!DOCTYPE html>
   <html lang="en">
   <head>
       <meta charset="UTF-8">
       <title>Personnel Login</title>
       <link rel="stylesheet" href="{% static 'css/styles.css' %}">
   </head>
   <body>
       <h2>Personnel Login</h2>
       {% if messages %}
           <ul>
               {% for message in messages %}
                   <li>{{ message }}</li>
               {% endfor %}
           </ul>
       {% endif %}
       <form method="POST">
           {% csrf_token %}
           <div>
               <label for="username">Username:</label>
               <input type="text" id="username" name="username" required>
           </div>
           <div>
               <label for="password">Password:</label>
               <input type="password" id="password" name="password" required>
           </div>
           <button type="submit">Login</button>
       </form>
       <p>Authorized Users, <a href="{% url 'authorized_login' %}">Login Here</a></p>
   </body>
   </html>
   ```

3. **Create `authorized_login.html`:**

   ```html
   <!-- backend/employees/templates/employees/authorized_login.html -->

   <!DOCTYPE html>
   <html lang="en">
   <head>
       <meta charset="UTF-8">
       <title>Authorized User Login</title>
       <link rel="stylesheet" href="{% static 'css/styles.css' %}">
   </head>
   <body>
       <h2>Authorized User Login</h2>
       {% if messages %}
           <ul>
               {% for message in messages %}
                   <li>{{ message }}</li>
               {% endfor %}
           </ul>
       {% endif %}
       <form method="POST">
           {% csrf_token %}
           <div>
               <label for="username">Username:</label>
               <input type="text" id="username" name="username" required>
           </div>
           <div>
               <label for="password">Password:</label>
               <input type="password" id="password" name="password" required>
           </div>
           <button type="submit">Login</button>
       </form>
       <p>Personnel, <a href="{% url 'personnel_login' %}">Login Here</a></p>
   </body>
   </html>
   ```

4. **Configure Template Loading (If Not Already):**

   Ensure your `settings.py` is configured to find templates.

   ```python
   # backend/settings.py

   TEMPLATES = [
       {
           "BACKEND": "django.template.backends.django.DjangoTemplates",
           "DIRS": [BASE_DIR / 'templates'],  # Add this line if you have a global templates directory
           "APP_DIRS": True,
           "OPTIONS": {
               "context_processors": [
                   "django.template.context_processors.debug",
                   "django.template.context_processors.request",
                   "django.contrib.auth.context_processors.auth",
                   "django.contrib.messages.context_processors.messages",
               ],
           },
       },
   ]
   ```

   Alternatively, since templates are within the app, ensure `APP_DIRS: True` is set (which it is).

#### **2.1.4. Create Dashboards for Personnel and Authorized Users**

**Action:**
- Develop separate dashboard views and templates for Personnel and Authorized Users.

**Implementation:**

1. **Define Dashboard Views in `views.py`:**

   ```python
   # backend/employees/views.py

   from django.contrib.auth.decorators import login_required, user_passes_test
   from django.shortcuts import render

   def is_personnel(user):
       return user.is_authenticated and not user.is_authorized

   def is_authorized_user(user):
       return user.is_authenticated and user.is_authorized

   @login_required(login_url='personnel_login')
   @user_passes_test(is_personnel)
   def personnel_dashboard(request):
       return render(request, 'employees/personnel_dashboard.html')

   @login_required(login_url='authorized_login')
   @user_passes_test(is_authorized_user)
   def authorized_dashboard(request):
       return render(request, 'employees/authorized_dashboard.html')
   ```

   **Explanation:**
   - **`login_required`**: Ensures the user is authenticated.
   - **`user_passes_test`**: Ensures the user has the correct role.
   
2. **Update `employees/urls.py` to Include Dashboards:**

   ```python
   # backend/employees/urls.py

   from django.urls import path
   from . import views
   from django.contrib.auth import views as auth_views

   urlpatterns = [
       # Authentication URLs
       path('login/personnel/', views.personnel_login, name='personnel_login'),
       path('logout/personnel/', auth_views.LogoutView.as_view(next_page='personnel_login'), name='personnel_logout'),

       path('login/authorized/', views.authorized_login, name='authorized_login'),
       path('logout/authorized/', auth_views.LogoutView.as_view(next_page='authorized_login'), name='authorized_logout'),

       # Dashboard URLs
       path('dashboard/personnel/', views.personnel_dashboard, name='personnel_dashboard'),
       path('dashboard/authorized/', views.authorized_dashboard, name='authorized_dashboard'),
   ]
   ```

3. **Create Dashboard Templates:**

   - **`personnel_dashboard.html`:**

     ```html
     <!-- backend/employees/templates/employees/personnel_dashboard.html -->

     <!DOCTYPE html>
     <html lang="en">
     <head>
         <meta charset="UTF-8">
         <title>Personnel Dashboard</title>
         <link rel="stylesheet" href="{% static 'css/styles.css' %}">
     </head>
     <body>
         <h1>Welcome, {{ request.user.username }} (Personnel)</h1>
         <a href="{% url 'personnel_logout' %}">Logout</a>
         <!-- Add Personnel-specific functionalities here -->
         <p><a href="{% url 'attendance_check_in' %}">Check In</a> | <a href="{% url 'attendance_check_out' %}">Check Out</a></p>
     </body>
     </html>
     ```

   - **`authorized_dashboard.html`:**

     ```html
     <!-- backend/employees/templates/employees/authorized_dashboard.html -->

     <!DOCTYPE html>
     <html lang="en">
     <head>
         <meta charset="UTF-8">
         <title>Authorized User Dashboard</title>
         <link rel="stylesheet" href="{% static 'css/styles.css' %}">
     </head>
     <body>
         <h1>Welcome, {{ request.user.username }} (Authorized User)</h1>
         <a href="{% url 'authorized_logout' %}">Logout</a>
         <!-- Add Authorized User-specific functionalities here -->
         <p><a href="{% url 'view_attendance_records' %}">View Attendance Records</a></p>
     </body>
     </html>
     ```

4. **Add Static Files Configuration (Optional):**

   If you plan to use CSS or JS, set up static files.

   ```python
   # backend/settings.py

   STATIC_URL = '/static/'
   STATICFILES_DIRS = [BASE_DIR / 'static']
   ```

   Create the `static` directory at the project root.

   ```bash
   mkdir -p static/css
   touch static/css/styles.css
   ```

   You can add your CSS styles in `static/css/styles.css`.

#### **2.1.5. Protecting Views Based on User Roles**

**Action:**
- Use decorators to ensure that only Personnel can access Personnel views and only Authorized Users can access their respective views.

**Implementation:**

1. **Using `@login_required` and `@user_passes_test`:**

   We have already used these decorators in the dashboard views.

   ```python
   # backend/employees/views.py

   from django.contrib.auth.decorators import login_required, user_passes_test
   from django.shortcuts import render

   def is_personnel(user):
       return user.is_authenticated and not user.is_authorized

   def is_authorized_user(user):
       return user.is_authenticated and user.is_authorized

   @login_required(login_url='personnel_login')
   @user_passes_test(is_personnel)
   def personnel_dashboard(request):
       return render(request, 'employees/personnel_dashboard.html')

   @login_required(login_url='authorized_login')
   @user_passes_test(is_authorized_user)
   def authorized_dashboard(request):
       return render(request, 'employees/authorized_dashboard.html')
   ```

2. **Creating Custom Decorators (Optional for Reusability):**

   If you have multiple views needing role-based access, consider creating custom decorators.

   ```python
   # backend/employees/decorators.py

   from django.contrib.auth.decorators import user_passes_test

   def personnel_required(function=None, redirect_field_name='next', login_url='personnel_login'):
       actual_decorator = user_passes_test(
           lambda u: u.is_authenticated and not u.is_authorized,
           login_url=login_url,
           redirect_field_name=redirect_field_name
       )
       if function:
           return actual_decorator(function)
       return actual_decorator

   def authorized_user_required(function=None, redirect_field_name='next', login_url='authorized_login'):
       actual_decorator = user_passes_test(
           lambda u: u.is_authenticated and u.is_authorized,
           login_url=login_url,
           redirect_field_name=redirect_field_name
       )
       if function:
           return actual_decorator(function)
       return actual_decorator
   ```

   **Usage in `views.py`:**

   ```python
   # backend/employees/views.py

   from .decorators import personnel_required, authorized_user_required

   @personnel_required
   def personnel_dashboard(request):
       return render(request, 'employees/personnel_dashboard.html')

   @authorized_user_required
   def authorized_dashboard(request):
       return render(request, 'employees/authorized_dashboard.html')
   ```

3. **Adding Related Views:**

   You can now create additional views for Personnel and Authorized Users, ensuring they are protected using the appropriate decorators.

---

## **2.2. Develop Attendance Tracking Features**

### **Objective:**
- Allow Personnel to **Check-In** and **Check-Out**.
- Automatically record the first check-in and last check-out of each day.
- Calculate lateness based on the company’s start time (08:00 AM).
- Provide data for Authorized Users to view attendance records.

### **Approach:**
1. **Create Attendance Models:**
   - Use the existing `AttendanceRecord` model defined earlier.
   
2. **Develop Attendance Views and Forms:**
   - Create views for Personnel to perform Check-In and Check-Out.
   - Ensure only one Check-In and one Check-Out per day.
   
3. **Calculate Lateness:**
   - Compare Check-In time with the company’s start time.
   - Calculate the duration of lateness if any.
   
4. **Develop API Endpoints (Using Django Rest Framework):**
   - Allow Personnel to interact with attendance via APIs if desired.
   
5. **Create Authorized User Views:**
   - Enable Authorized Users to view and manage attendance records.

### **Step-by-Step Implementation:**

#### **2.2.1. Utilize the Existing `AttendanceRecord` Model**

**Model Recap:**

```python
# backend/employees/models.py

from django.conf import settings
from django.db import models

class AttendanceRecord(models.Model):
    employee = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name='attendance_records')
    date = models.DateField()
    first_check_in = models.TimeField(null=True, blank=True)
    last_check_out = models.TimeField(null=True, blank=True)
    is_late = models.BooleanField(default=False)
    lateness_duration = models.DurationField(null=True, blank=True)

    def __str__(self):
        return f"{self.employee.username} - {self.date}"
```

**Notes:**
- This model captures daily attendance with Check-In and Check-Out times.
- Fields:
  - `first_check_in`: Stores the earliest Check-In time each day.
  - `last_check_out`: Stores the latest Check-Out time each day.
  - `is_late`: Indicates if the employee was late.
  - `lateness_duration`: Records how long the employee was late.

#### **2.2.2. Create Attendance Forms**

**Action:**
- Develop forms for Personnel to perform Check-In and Check-Out.

**Implementation:**

1. **Create `forms.py` in the `employees` App:**

   ```bash
   touch backend/employees/forms.py
   ```

2. **Define Forms:**

   ```python
   # backend/employees/forms.py

   from django import forms

   class CheckInForm(forms.Form):
       check_in_time = forms.TimeField(widget=forms.TimeInput(format='%H:%M'), input_formats=['%H:%M'], required=False)

   class CheckOutForm(forms.Form):
       check_out_time = forms.TimeField(widget=forms.TimeInput(format='%H:%M'), input_formats=['%H:%M'], required=False)
   ```

   **Notes:**
   - Both forms have optional fields as the server can auto-populate the current time if left blank.
   - Alternatively, you can omit fields altogether and have the server assign the current time.

#### **2.2.3. Create Attendance Views**

**Action:**
- Develop views to handle Check-In and Check-Out.

**Implementation:**

1. **Update `views.py` with Attendance Views:**

   ```python
   # backend/employees/views.py

   from django.utils import timezone
   from .forms import CheckInForm, CheckOutForm
   from .models import AttendanceRecord
   from datetime import datetime, time, timedelta

   @login_required(login_url='personnel_login')
   @user_passes_test(is_personnel)
   def attendance_check_in(request):
       user = request.user
       today = timezone.now().date()
       now_time = timezone.now().time()

       attendance, created = AttendanceRecord.objects.get_or_create(employee=user, date=today)

       if attendance.first_check_in:
           messages.info(request, "You have already checked in today.")
           return redirect('personnel_dashboard')

       if request.method == 'POST':
           form = CheckInForm(request.POST)
           if form.is_valid():
               check_in_time = form.cleaned_data.get('check_in_time') or now_time
               attendance.first_check_in = check_in_time

               # Determine if late
               company_start_time = time(8, 0)  # 08:00 AM
               if check_in_time > company_start_time:
                   attendance.is_late = True
                   # Calculate lateness_duration
                   check_in_datetime = datetime.combine(today, check_in_time)
                   company_start_datetime = datetime.combine(today, company_start_time)
                   lateness = check_in_datetime - company_start_datetime
                   attendance.lateness_duration = lateness
               else:
                   attendance.is_late = False
                   attendance.lateness_duration = None

               attendance.save()
               messages.success(request, "Check-In successful.")
               return redirect('personnel_dashboard')
       else:
           form = CheckInForm()

       context = {
           'form': form
       }
       return render(request, 'employees/attendance_check_in.html', context)

   @login_required(login_url='personnel_login')
   @user_passes_test(is_personnel)
   def attendance_check_out(request):
       user = request.user
       today = timezone.now().date()
       now_time = timezone.now().time()

       try:
           attendance = AttendanceRecord.objects.get(employee=user, date=today)
       except AttendanceRecord.DoesNotExist:
           messages.error(request, "You haven't checked in today.")
           return redirect('personnel_dashboard')

       if attendance.last_check_out:
           messages.info(request, "You have already checked out today.")
           return redirect('personnel_dashboard')

       if request.method == 'POST':
           form = CheckOutForm(request.POST)
           if form.is_valid():
               check_out_time = form.cleaned_data.get('check_out_time') or now_time
               attendance.last_check_out = check_out_time
               attendance.save()
               messages.success(request, "Check-Out successful.")
               return redirect('personnel_dashboard')
       else:
           form = CheckOutForm()

       context = {
           'form': form
       }
       return render(request, 'employees/attendance_check_out.html', context)
   ```

   **Explanation:**
   - **`attendance_check_in`**:
     - Checks if the user has already checked in today. If not, processes the Check-In.
     - Determines lateness by comparing Check-In time with company start time (08:00 AM).
     - Records Check-In time and lateness details.
  
   - **`attendance_check_out`**:
     - Checks if the user has checked in today.
     - Checks if the user has already checked out today. If not, processes the Check-Out.
     - Records Check-Out time.

2. **Handle Edge Cases:**
   - **No Check-In Before Check-Out:**
     - If a user tries to Check-Out without having checked in, display an error.
     
   - **Multiple Check-Ins/ChecK-Outs:**
     - Prevent multiple Check-Ins or Check-Outs in a single day.

3. **Define URLs for Attendance Views:**

   ```python
   # backend/employees/urls.py

   from django.urls import path
   from . import views
   from django.contrib.auth import views as auth_views

   urlpatterns = [
       # Authentication URLs
       path('login/personnel/', views.personnel_login, name='personnel_login'),
       path('logout/personnel/', auth_views.LogoutView.as_view(next_page='personnel_login'), name='personnel_logout'),

       path('login/authorized/', views.authorized_login, name='authorized_login'),
       path('logout/authorized/', auth_views.LogoutView.as_view(next_page='authorized_login'), name='authorized_logout'),

       # Dashboard URLs
       path('dashboard/personnel/', views.personnel_dashboard, name='personnel_dashboard'),
       path('dashboard/authorized/', views.authorized_dashboard, name='authorized_dashboard'),

       # Attendance URLs
       path('attendance/check-in/', views.attendance_check_in, name='attendance_check_in'),
       path('attendance/check-out/', views.attendance_check_out, name='attendance_check_out'),
   ]
   ```

4. **Create Attendance Templates:**

   - **`attendance_check_in.html`:**

     ```html
     <!-- backend/employees/templates/employees/attendance_check_in.html -->

     <!DOCTYPE html>
     <html lang="en">
     <head>
         <meta charset="UTF-8">
         <title>Attendance Check-In</title>
         <link rel="stylesheet" href="{% static 'css/styles.css' %}">
     </head>
     <body>
         <h2>Attendance Check-In</h2>
         <a href="{% url 'personnel_dashboard' %}">Back to Dashboard</a>
         {% if messages %}
             <ul>
                 {% for message in messages %}
                     <li>{{ message }}</li>
                 {% endfor %}
             </ul>
         {% endif %}
         <form method="POST">
             {% csrf_token %}
             {{ form.as_p }}
             <button type="submit">Check In</button>
         </form>
     </body>
     </html>
     ```

   - **`attendance_check_out.html`:**

     ```html
     <!-- backend/employees/templates/employees/attendance_check_out.html -->

     <!DOCTYPE html>
     <html lang="en">
     <head>
         <meta charset="UTF-8">
         <title>Attendance Check-Out</title>
         <link rel="stylesheet" href="{% static 'css/styles.css' %}">
     </head>
     <body>
         <h2>Attendance Check-Out</h2>
         <a href="{% url 'personnel_dashboard' %}">Back to Dashboard</a>
         {% if messages %}
             <ul>
                 {% for message in messages %}
                     <li>{{ message }}</li>
                 {% endfor %}
             </ul>
         {% endif %}
         <form method="POST">
             {% csrf_token %}
             {{ form.as_p }}
             <button type="submit">Check Out</button>
         </form>
     </body>
     </html>
     ```

5. **Add Attendance Links to Dashboard:**

   Ensure that the Personnel Dashboard provides links to Check-In and Check-Out.

   ```html
   <!-- backend/employees/templates/employees/personnel_dashboard.html -->

   <!DOCTYPE html>
   <html lang="en">
   <head>
       <meta charset="UTF-8">
       <title>Personnel Dashboard</title>
       <link rel="stylesheet" href="{% static 'css/styles.css' %}">
   </head>
   <body>
       <h1>Welcome, {{ request.user.username }} (Personnel)</h1>
       <a href="{% url 'personnel_logout' %}">Logout</a>
       <!-- Add Personnel-specific functionalities here -->
       <p>
           <a href="{% url 'attendance_check_in' %}">Check In</a> | 
           <a href="{% url 'attendance_check_out' %}">Check Out</a>
       </p>
   </body>
   </html>
   ```

#### **2.2.4. Automate Attendance Creation via Signals (Optional Enhancement)**

**Objective:**
- Automatically create an `AttendanceRecord` for each user at the start of a new day.

**Implementation:**

This step is optional since in the current implementation, `Check-In` creates or updates the `AttendanceRecord`.

However, if you prefer to have records created automatically each day, consider using a scheduled task with **Celery** or a cron job. Given that Celery is listed as a bonus feature, we can focus on manual creation via Check-In.

#### **2.2.5. Calculate and Handle Lateness**

**Notes:**
- If a user checks in after 08:00 AM, mark them as late and record the duration.
- This has been handled in the `attendance_check_in` view.

**Enhancements:**
- Display lateness information in the dashboard.
- Notify Authorized Users if a user is late (part of notifications).

#### **2.2.6. Develop Attendance Reporting for Authorized Users**

**Action:**
- Allow Authorized Users to view attendance records.

**Implementation:**

1. **Create a View to Display Attendance Records:**

   ```python
   # backend/employees/views.py

   from django.db.models import Q
   from django.core.paginator import Paginator

   @login_required(login_url='authorized_login')
   @user_passes_test(is_authorized_user)
   def view_attendance_records(request):
       records = AttendanceRecord.objects.select_related('employee').all().order_by('-date')
       
       # Search or filter functionality can be added here
       query = request.GET.get('q')
       if query:
           records = records.filter(
               Q(employee__username__icontains=query) |
               Q(employee__profile__full_name__icontains=query)
           )
       
       # Pagination
       paginator = Paginator(records, 20)  # Show 20 records per page
       page_number = request.GET.get('page')
       page_obj = paginator.get_page(page_number)
       
       context = {
           'page_obj': page_obj,
           'query': query,
       }
       return render(request, 'employees/view_attendance_records.html', context)
   ```

2. **Define URL for Attendance Records:**

   ```python
   # backend/employees/urls.py

   urlpatterns += [
       # Attendance Reporting
       path('attendance/records/', views.view_attendance_records, name='view_attendance_records'),
   ]
   ```

3. **Create Template for Attendance Records:**

   ```html
   <!-- backend/employees/templates/employees/view_attendance_records.html -->

   <!DOCTYPE html>
   <html lang="en">
   <head>
       <meta charset="UTF-8">
       <title>Attendance Records</title>
       <link rel="stylesheet" href="{% static 'css/styles.css' %}">
   </head>
   <body>
       <h1>Attendance Records</h1>
       <a href="{% url 'authorized_dashboard' %}">Back to Dashboard</a>
       <a href="{% url 'authorized_logout' %}">Logout</a>

       <form method="GET" action="{% url 'view_attendance_records' %}">
           <input type="text" name="q" placeholder="Search by username or name" value="{{ query }}">
           <button type="submit">Search</button>
       </form>

       <table border="1">
           <thead>
               <tr>
                   <th>Date</th>
                   <th>Employee Username</th>
                   <th>Employee Name</th>
                   <th>First Check-In</th>
                   <th>Last Check-Out</th>
                   <th>Is Late</th>
                   <th>Lateness Duration</th>
               </tr>
           </thead>
           <tbody>
               {% for record in page_obj.object_list %}
                   <tr>
                       <td>{{ record.date }}</td>
                       <td>{{ record.employee.username }}</td>
                       <td>{{ record.employee.profile.full_name }}</td>
                       <td>{% if record.first_check_in %}{{ record.first_check_in }}{% else %}--{% endif %}</td>
                       <td>{% if record.last_check_out %}{{ record.last_check_out }}{% else %}--{% endif %}</td>
                       <td>{{ record.is_late }}</td>
                       <td>
                           {% if record.lateness_duration %}
                               {{ record.lateness_duration }}
                           {% else %}
                               --
                           {% endif %}
                       </td>
                   </tr>
               {% empty %}
                   <tr>
                       <td colspan="7">No records found.</td>
                   </tr>
               {% endfor %}
           </tbody>
       </table>

       <!-- Pagination Controls -->
       <div class="pagination">
           <span class="step-links">
               {% if page_obj.has_previous %}
                   <a href="?page=1{% if query %}&q={{ query }}{% endif %}">&laquo; first</a>
                   <a href="?page={{ page_obj.previous_page_number }}{% if query %}&q={{ query }}{% endif %}">previous</a>
               {% endif %}

               <span class="current">
                   Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
               </span>

               {% if page_obj.has_next %}
                   <a href="?page={{ page_obj.next_page_number }}{% if query %}&q={{ query }}{% endif %}">next</a>
                   <a href="?page={{ page_obj.paginator.num_pages }}{% if query %}&q={{ query }}{% endif %}">last &raquo;</a>
               {% endif %}
           </span>
       </div>
   </body>
   </html>
   ```

4. **Add Link to Dashboards:**

   Update the Authorized User dashboard to include a link to attendance records.

   ```html
   <!-- backend/employees/templates/employees/authorized_dashboard.html -->

   <!DOCTYPE html>
   <html lang="en">
   <head>
       <meta charset="UTF-8">
       <title>Authorized User Dashboard</title>
       <link rel="stylesheet" href="{% static 'css/styles.css' %}">
   </head>
   <body>
       <h1>Welcome, {{ request.user.username }} (Authorized User)</h1>
       <a href="{% url 'authorized_logout' %}">Logout</a>
       <!-- Add Authorized User-specific functionalities here -->
       <p><a href="{% url 'view_attendance_records' %}">View Attendance Records</a></p>
   </body>
   </html>
   ```

#### **2.2.7. Testing Attendance Features**

**Action:**
- Ensure that Personnel can successfully Check-In and Check-Out.
- Validate that lateness is correctly calculated.
- Confirm that Authorized Users can view attendance records.

**Implementation:**

1. **Run the Development Server:**

   ```bash
   python manage.py runserver
   ```

2. **Create Test Users:**

   - **Personnel User:**

     - **Username:** `john_personnel`
     - **Password:** `password123`
     - **is_authorized:** `False`

   - **Authorized User:**

     - **Username:** `jane_authorized`
     - **Password:** `password123`
     - **is_authorized:** `True`

     You can create these users via the Django admin interface (`/admin/`).

3. **Perform Check-In as Personnel:**

   - Navigate to `/auth/login/personnel/` and log in as `john_personnel`.
   - Click on "Check In" and submit.
   - Ensure that the `AttendanceRecord` is created with the correct `first_check_in` time.
   - If Check-In time is after 08:00 AM, verify that `is_late` is marked as `True` and `lateness_duration` is accurate.

4. **Perform Check-Out as Personnel:**

   - After Check-In, navigate to "Check Out" and submit.
   - Ensure that `last_check_out` is recorded.

5. **View Attendance Records as Authorized User:**

   - Navigate to `/auth/login/authorized/` and log in as `jane_authorized`.
   - Access the "View Attendance Records" page.
   - Verify that all records are displayed correctly, with proper indications of lateness.

6. **Edge Case Testing:**

   - Attempt multiple Check-Ins or Check-Outs on the same day and ensure the system prevents duplicates.
   - Try Check-Out without Check-In and verify that an error is displayed.

---

## **2.3. Enhancing Authentication Security and User Experience**

While basic authentication is now set up, enhancing security and improving user experience can further solidify the system's reliability and usability.

### **2.3.1. Password Validation and Strength**

**Action:**
- Enforce strong passwords to enhance security.

**Implementation:**

You already have the following password validators in `settings.py`:

```python
AUTH_PASSWORD_VALIDATORS = [
    {
        "NAME": "django.contrib.auth.password_validation.UserAttributeSimilarityValidator",
    },
    {
        "NAME": "django.contrib.auth.password_validation.MinimumLengthValidator",
    },
    {
        "NAME": "django.contrib.auth.password_validation.CommonPasswordValidator",
    },
    {
        "NAME": "django.contrib.auth.password_validation.NumericPasswordValidator",
    },
]
```

**Suggestion:**
- Customize the `MinimumLengthValidator` to enforce longer passwords.

**Example:**

```python
# backend/settings.py

AUTH_PASSWORD_VALIDATORS = [
    # ... existing validators ...
    {
        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
        'OPTIONS': {
            'min_length': 8,  # Enforce minimum length
        }
    },
]
```

### **2.3.2. Implementing Login Required for All Protected Views**

Ensure that all views that require authentication are properly protected using the `@login_required` decorator.

**Example:**

```python
# backend/employees/views.py

from django.contrib.auth.decorators import login_required, user_passes_test

# Define role-based tests
def is_personnel(user):
    return user.is_authenticated and not user.is_authorized

def is_authorized_user(user):
    return user.is_authenticated and user.is_authorized

@login_required(login_url='personnel_login')
@user_passes_test(is_personnel)
def personnel_dashboard(request):
    # View logic
    pass
```

### **2.3.3. Flash Messages for User Feedback**

Ensure that all forms provide user-friendly feedback using Django's messaging framework.

**Implementation:**

We have already included messages in the forms and views. Ensure that your templates have a section to display these messages, as shown in previous templates.

**Example:**

```html
<!-- Example message display in templates -->

{% if messages %}
    <ul>
        {% for message in messages %}
            <li>{{ message }}</li>
        {% endfor %}
    </ul>
{% endif %}
```

### **2.3.4. Improving User Interface**

**Action:**
- Enhance the UI using CSS frameworks like Bootstrap for better aesthetics and responsiveness.

**Implementation:**

1. **Include Bootstrap in Templates:**

   Add Bootstrap CDN links to your HTML templates.

   ```html
   <!-- Example: Add this in the <head> section of your templates -->

   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
   ```

2. **Update Templates to Use Bootstrap Classes:**

   Update forms and other elements to utilize Bootstrap for styling.

   **Example:**

   ```html
   <!-- backend/employees/templates/employees/personnel_login.html -->

   <!DOCTYPE html>
   <html lang="en">
   <head>
       <meta charset="UTF-8">
       <title>Personnel Login</title>
       <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
   </head>
   <body>
       <div class="container mt-5">
           <h2 class="mb-4">Personnel Login</h2>
           {% if messages %}
               <div class="alert alert-danger">
                   {% for message in messages %}
                       <p>{{ message }}</p>
                   {% endfor %}
               </div>
           {% endif %}
           <form method="POST">
               {% csrf_token %}
               <div class="mb-3">
                   <label for="username" class="form-label">Username:</label>
                   <input type="text" class="form-control" id="username" name="username" required>
               </div>
               <div class="mb-3">
                   <label for="password" class="form-label">Password:</label>
                   <input type="password" class="form-control" id="password" name="password" required>
               </div>
               <button type="submit" class="btn btn-primary">Login</button>
           </form>
           <p class="mt-3">Authorized Users, <a href="{% url 'authorized_login' %}">Login Here</a></p>
       </div>
   </body>
   </html>
   ```

3. **Apply Similar Enhancements to Other Templates:**

   Update `authorized_login.html`, `personnel_dashboard.html`, `authorized_dashboard.html`, `attendance_check_in.html`, `attendance_check_out.html`, and `view_attendance_records.html` similarly to utilize Bootstrap components for a cohesive and responsive UI.

### **2.3.5. Redirect Authenticated Users Appropriately**

**Action:**
- Prevent authenticated users from accessing the login pages again. Redirect them to their dashboards if they try.

**Implementation:**

1. **Modify Login Views to Redirect Authenticated Users:**

   ```python
   # backend/employees/views.py

   from django.contrib.auth import authenticate, login
   from django.shortcuts import render, redirect
   from django.contrib import messages

   def personnel_login(request):
       if request.user.is_authenticated and not request.user.is_authorized:
           return redirect('personnel_dashboard')
       elif request.user.is_authenticated and request.user.is_authorized:
           return redirect('authorized_dashboard')

       if request.method == 'POST':
           # ... existing logic ...

   def authorized_login(request):
       if request.user.is_authenticated and request.user.is_authorized:
           return redirect('authorized_dashboard')
       elif request.user.is_authenticated and not request.user.is_authorized:
           return redirect('personnel_dashboard')

       if request.method == 'POST':
           # ... existing logic ...
   ```

---

## **2.4. Summary of Authentication Implementation**

By following the steps above, you have successfully:

1. **Established Separate Authentication Mechanisms:**
   - Defined distinct URLs for Personnel and Authorized Users.
   - Created specialized login views and templates.
   
2. **Implemented Role-Based Access Control:**
   - Used Django decorators to restrict view access based on user roles.
   - Ensured that only authorized users can access specific dashboards and functionalities.
   
3. **Enhanced User Experience:**
   - Incorporated Bootstrap for improved UI aesthetics and responsiveness.
   - Provided meaningful feedback using Django's messaging framework.
   
4. **Facilitated Seamless Navigation:**
   - Enabled smooth redirects post-authentication based on user roles.
   - Ensured authenticated users are redirected to appropriate dashboards when accessing login pages.

---

## **2.5. Commit Changes to Git**

**Action:**
- Save and track your progress by committing the changes to your Git repository.

**Implementation:**

1. **Stage the Changes:**

   ```bash
   git add .
   ```

2. **Commit with a Descriptive Message:**

   ```bash
   git commit -m "Implement separate authentication for Personnel and Authorized Users; develop attendance tracking features"
   ```

3. **Push to GitHub:**

   ```bash
   git push origin main
   ```

---

## **Next Steps**

With authentication and basic attendance tracking implemented, the next phases include:

1. **Enhancing Attendance Features:**
   - Implement automatic deductions from annual leave based on lateness.
   - Develop notifications for Authorized Users when employees are late or have low leave balances.

2. **Developing Leave Management:**
   - Allow employees to view and request leaves.
   - Enable Authorized Users to approve or reject leave requests.

3. **Reporting Mechanism:**
   - Generate monthly reports summarizing employee working hours.

4. **Implement Additional (Bonus) Features:**
   - Set up Celery for asynchronous tasks like sending notifications.
   - Containerize the application using Docker.
   - Integrate Swagger for API documentation.

---

## **Final Recommendations**

- **Regular Testing:**
  - Continually test authentication flows and attendance functionalities to ensure reliability.
  
- **Use Django’s Built-In Features:**
  - Leverage Django's robust authentication system to maintain security standards.

- **Maintain Code Quality:**
  - Adhere to PEP 8 standards.
  - Use linters and formatters like `flake8` and `black`.

- **Documentation:**
  - Document your code and functionalities as you develop to ease future maintenance and onboarding.

- **Backup Your Data:**
  - Regularly backup your database, especially before making significant changes or migrations.

---

By meticulously implementing authentication and attendance tracking now, you lay a solid foundation for the subsequent features of your application. Continue to build incrementally, ensuring each component functions correctly before proceeding to the next.

If you encounter any issues or need further assistance as you progress, feel free to reach out!